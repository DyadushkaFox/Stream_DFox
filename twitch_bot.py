import time
import requests
import os
import random
from dotenv import load_dotenv
from twitchio import Client, Message

# Загружаем переменные окружения
load_dotenv('fox.env')

# Конфигурация Twitch API и бота
TWITCH_CLIENT_ID = os.getenv('TWITCH_CLIENT_ID')
TWITCH_OAUTH_TOKEN = os.getenv('TWITCH_OAUTH_TOKEN')
TWITCH_BOT_USERNAME = os.getenv('TWITCH_BOT_USERNAME')
TWITCH_CHANNEL = "Dyadushka_Fox"  # Имя канала

# Список вопросов для чата
questions = [
    "Какой твой любимый жанр игр?",
    "Что думаешь о последних обновлениях в игре?",
    "Какую игру ты планируешь пройти в ближайшее время?",
    "Какие твои любимые игры в жанре RPG?",
    "Кто твой любимый персонаж в играх?",
    "Какую игру ты считаешь самой сложной?",
    "Какие стримы ты обычно смотришь на Twitch?",
    "Какие игры ты больше всего ждешь в следующем году?",
    "Что ты думаешь о VR-играх?",
    "Какую игру ты бы порекомендовал друзьям?",
    "Если бы у тебя была возможность стать героем игры, кем бы ты стал?",
    "Что бы ты сделал, если бы оказался в мире своей любимой игры?",
    "Сколько времени ты обычно проводишь за играми в день?",
    "Какая твоя любимая видеоигра всех времен?",
    "Ты предпочитаешь играть в одиночку или с друзьями?",
    "Какие игры ты предпочитаешь: ПК, консоли или мобильные?",
    "Что для тебя важнее в игре: сюжет или геймплей?",
    "Какие игры тебе нравятся, но ты не можешь найти время на них?",
    "Какую музыку ты слушаешь, играя в игры?",
    "В какой игре ты больше всего прокачивал своего персонажа?",
    "Какая игра, по твоему мнению, имеет лучший сюжет?",
    "Какую игру ты бы хотел увидеть в ремастере?",
    "Какие игры тебе нравятся, но никто из твоих друзей их не играет?",
    "Как ты относишься к кросс-платформенному геймингу?",
    "Какой жанр игр ты бы хотел попробовать, но еще не пробовал?",
    "Что тебя больше всего привлекает в мультиплеерных играх?",
    "Кто твой любимый стример на Twitch?",
    "Какую игру ты бы хотел стримить на своем канале?",
    "Как ты относишься к эспортам?",
    "Как ты думаешь, какой будет следующая большая игра на рынке?",
    "Что ты думаешь о новых технологиях в играх?",
    "С кем бы ты хотел сыграть в совместные игры?",
    "Какие игры ты считаешь недооцененными?",
    "Какой у тебя самый любимый игровой момент?",
    "Какие навыки тебе пришлось развить, чтобы стать лучше в игре?",
    "Какой момент из игры заставил тебя переживать больше всего?",
    "В какой игре ты добился наибольших успехов?",
    "Что ты думаешь о новых трендах в индустрии игр?",
    "Как ты относишься к микротранзакциям в играх?",
    "Какую игру ты бы порекомендовал для расслабления после тяжелого дня?",
    "Что думаешь о ретро-играх?",
    "Какие игры ты бы хотел перепройти?",
    "Какие игры ты бы взял с собой на остров, если бы мог взять только несколько?",
    "Как ты относишься к мобильным играм?",
    "Есть ли у тебя любимые игровые компании?",
    "Какую игру ты бы хотел увидеть с открытым миром?",
    "Какой твой любимый момент в последней игре, которую ты прошел?",
    "Какие игры тебя больше всего удивили в плане графики?",
    "Какую игру ты считаешь наиболее захватывающей?",
    "Кто твой любимый разработчик игр?",
    "Какие игры тебе нравятся, но они тебе кажутся слишком сложными?",
    "Какие игры ты бы не стал играть, если бы знал, как они закончились?",
    "Какие игры ты считаешь лучшими для вечерних посиделок с друзьями?",
    "Какую игру ты играл больше всего?",
    "Какой стример на Twitch тебе больше всего нравится?",
    "Какую игру ты бы хотел увидеть в жанре фэнтези?",
    "Какие стримы ты предпочитаешь смотреть на Twitch?",
    "Какой твой любимый момент из последней игры, которую ты прошел?",
    "Как ты относишься к пиксельной графике в играх?",
    "Какие игры тебе нравятся, несмотря на их критику?",
    "Как ты думаешь, какой будет следующая большая волна игр в индустрии?",
    "Что ты думаешь о выходе новых консолей?",
    "Как ты относишься к жанру хоррор в играх?",
    "В какой игре ты бы хотел провести больше времени?",
    "Какая игра стала для тебя неожиданной находкой?",
    "Как ты оцениваешь игры с открытым миром?",
    "Что для тебя важнее в игре: графика или сюжет?",
    "Какие игры ты любишь стримить больше всего?",
    "Как ты думаешь, какая будет следующая большая волна игр в индустрии?",
    "Какие игры, по твоему мнению, идеально подходят для совместной игры с друзьями?",
    "Какую игру ты бы порекомендовал новичкам?",
    "В какой игре ты провел больше всего времени?",
    "Какая игра стала для тебя классикой?",
    "Какие игры ты хочешь перепройти в ближайшее время?",
    "Как ты думаешь, какие игры будут популярны через 5 лет?",
    "Как ты относишься к ремейкам и ремастерам игр?",
    "Какие игры ты хотел бы увидеть на новых консолях?",
    "Какую игру ты бы порекомендовал на вечер для одного игрока?",
    "Какую игру ты бы выбрал для праздника с друзьями?",
    "Что думаешь о тренде на мультиплеерные игры?"
]

# Функция для проверки, идет ли стрим
def check_stream_status():
    url = f'https://api.twitch.tv/helix/streams?user_login={TWITCH_CHANNEL}'
    headers = {
        'Client-ID': TWITCH_CLIENT_ID,
        'Authorization': f'Bearer {TWITCH_OAUTH_TOKEN}'
    }
    response = requests.get(url, headers=headers)
    data = response.json()

    if data['data']:
        return True  # Стрим идет
    return False  # Стрим не идет

# Основной класс бота
class TwitchBot(Client):

    def __init__(self):
        super().__init__(token=TWITCH_OAUTH_TOKEN, client_id=TWITCH_CLIENT_ID)

    async def event_ready(self):
        print(f'Bot {TWITCH_BOT_USERNAME} is online and ready to chat!')
        while True:
            if check_stream_status():  # Проверка, идет ли стрим
                print("Stream is live! Starting bot...")
                await self.send_random_question()
                break  # Бот запустился и будет работать, пока идет стрим
            else:
                print("Stream is offline. Waiting for stream to go live...")
                time.sleep(60)  # Проверяем каждую минуту

    async def send_random_question(self):
        # Выбираем случайный вопрос
        question = random.choice(questions)
        await self.channel.send(question)

    async def event_message(self, message: Message):
        # Ожидаем сообщений и реагируем
        print(f'{message.author.name}: {message.content}')

# Функция для запуска бота
def run_bot():
    bot = TwitchBot()
    bot.run()

if __name__ == '__main__':
    run_bot()
