import time
import random
import os
import requests
from dotenv import load_dotenv
import socket

# Загружаем данные из fox.env
load_dotenv(dotenv_path='fox.env')

# Токен и данные для Twitch API
client_id = os.getenv("TWITCH_CLIENT_ID")
oauth_token = os.getenv("TWITCH_OAUTH_TOKEN")

# Получаем список стримеров через API
def get_streamers():
    url = "https://api.twitch.tv/helix/streams?first=10"  # Получаем 10 активных стримеров
    headers = {
        "Client-ID": client_id,
        "Authorization": f"Bearer {oauth_token}"
    }
    response = requests.get(url, headers=headers)
    data = response.json()

    # Список профилей стримеров
    profiles = [f"https://www.twitch.tv/{stream['user_name']}" for stream in data['data']]
    return profiles

# Подключение к чату Twitch через IRC
def send_message(channel, message):
    server = "irc.chat.twitch.tv"
    port = 6667
    nick = "Bot_DFox"  # Имя бота
    token = oauth_token
    channel = f"#{channel}"

    # Подключение к серверу IRC
    s = socket.socket()
    s.connect((server, port))
    s.send(f"PASS {token}\r\n".encode('utf-8'))
    s.send(f"NICK {nick}\r\n".encode('utf-8'))
    s.send(f"JOIN {channel}\r\n".encode('utf-8'))

    # Отправка сообщения
    s.send(f"PRIVMSG {channel} :{message}\r\n".encode('utf-8'))
    
    # Закрытие соединения
    s.close()

# Список случайных вопросов для создания иллюзии зрителей
questions = [
    "Какой твой любимый жанр игр?",
    "Что думаешь о последних обновлениях в игре?",
    "Какую игру ты планируешь пройти в ближайшее время?",
    "Какие твои любимые игры в жанре RPG?",
    "Кто твой любимый персонаж в играх?",
    "Какую игру ты считаешь самой сложной?",
    "Какие стримы ты обычно смотришь на Twitch?",
    "Какие игры ты больше всего ждешь в следующем году?",
    "Что ты думаешь о VR-играх?",
    "Какую игру ты бы порекомендовал друзьям?",
    "Если бы у тебя была возможность стать героем игры, кем бы ты стал?",
    "Что бы ты сделал, если бы оказался в мире своей любимой игры?",
    "Сколько времени ты обычно проводишь за играми в день?",
    "Какая твоя любимая видеоигра всех времен?",
    "Ты предпочитаешь играть в одиночку или с друзьями?",
    "Какие игры ты предпочитаешь: ПК, консоли или мобильные?",
    "Что для тебя важнее в игре: сюжет или геймплей?",
    "Какие игры тебе нравятся, но ты не можешь найти время на них?",
    "Какую музыку ты слушаешь, играя в игры?",
    "В какой игре ты больше всего прокачивал своего персонажа?",
    "Какая игра, по твоему мнению, имеет лучший сюжет?",
    "Какую игру ты бы хотел увидеть в ремастере?",
    "Какие игры тебе нравятся, но никто из твоих друзей их не играет?",
    "Как ты относишься к кросс-платформенному геймингу?",
    "Какой жанр игр ты бы хотел попробовать, но еще не пробовал?",
    "Что тебя больше всего привлекает в мультиплеерных играх?",
    "Кто твой любимый стример на Twitch?",
    "Какую игру ты бы хотел стримить на своем канале?",
    "Как ты относишься к эспортам?",
    "Как ты думаешь, какой будет следующая большая игра на рынке?",
    "Что ты думаешь о новых технологиях в играх?",
    "С кем бы ты хотел сыграть в совместные игры?",
    "Какие игры ты считаешь недооцененными?",
    "Какой у тебя самый любимый игровой момент?",
    "Какие навыки тебе пришлось развить, чтобы стать лучше в игре?",
    "Какой момент из игры заставил тебя переживать больше всего?",
    "В какой игре ты добился наибольших успехов?",
    "Что ты думаешь о новых трендах в индустрии игр?",
    "Как ты относишься к микротранзакциям в играх?",
    "Какую игру ты бы порекомендовал для расслабления после тяжелого дня?",
    "Что думаешь о ретро-играх?",
    "Какие игры ты бы хотел перепройти?",
    "Какие игры ты бы взял с собой на остров, если бы мог взять только несколько?",
    "Как ты относишься к мобильным играм?",
    "Есть ли у тебя любимые игровые компании?",
    "Какую игру ты бы хотел увидеть с открытым миром?",
    "Какой твой любимый момент в последней игре, которую ты прошел?",
    "Какие игры тебя больше всего удивили в плане графики?",
    "Какую игру ты считаешь наиболее захватывающей?",
    "Кто твой любимый разработчик игр?",
    "Какие игры тебе нравятся, но они тебе кажутся слишком сложными?",
    "Какие игры ты бы не стал играть, если бы знал, как они закончились?",
    "Какие игры ты считаешь лучшими для вечерних посиделок с друзьями?",
    "Какую игру ты играл больше всего?",
    "Какой стример на Twitch тебе больше всего нравится?",
    "Какую игру ты бы хотел увидеть в жанре фэнтези?",
    "Какие стримы ты предпочитаешь смотреть на Twitch?",
    "Какой твой любимый момент из последней игры, которую ты прошел?",
    "Как ты относишься к пиксельной графике в играх?",
    "Какие игры тебе нравятся, несмотря на их критику?",
    "Как ты думаешь, какой будет следующая большая волна игр в индустрии?",
    "Что ты думаешь о выходе новых консолей?",
    "Как ты относишься к жанру хоррор в играх?",
    "В какой игре ты бы хотел провести больше времени?",
    "Какая игра стала для тебя неожиданной находкой?",
    "Как ты оцениваешь игры с открытым миром?",
    "Что для тебя важнее в игре: графика или сюжет?",
    "Какие игры ты любишь стримить больше всего?",
    "Как ты думаешь, какая будет следующая большая волна игр в индустрии?",
    "Какие игры, по твоему мнению, идеально подходят для совместной игры с друзьями?",
    "Какую игру ты бы порекомендовал новичкам?",
    "В какой игре ты провел больше всего времени?",
    "Какая игра стала для тебя классикой?",
    "Какие игры ты хочешь перепройти в ближайшее время?",
    "Как ты думаешь, какие игры будут популярны через 5 лет?",
    "Как ты относишься к ремейкам и ремастерам игр?",
    "Какие игры ты хотел бы увидеть на новых консолях?",
    "Какую игру ты бы порекомендовал на вечер для одного игрока?",
    "Какую игру ты бы выбрал для праздника с друзьями?",
    "Что думаешь о тренде на мультиплеерные игры?"
]

# Функция для отправки сообщений с интервалом
def run_bot(channel):
    while True:
        # Получаем список стримеров
        profiles = get_streamers()

        if profiles:
            # Выбираем случайную ссылку на профиль
            profile_to_send = random.choice(profiles)
            send_message(channel, f"Check out this profile: {profile_to_send}")

            # Генерация случайного вопроса от зрителей
            viewer_question = random.choice(questions)
            send_message(channel, viewer_question)

        else:
            send_message(channel, "Нет доступных стримеров на данный момент.")

        # Ждем 30 минут (1800 секунд)
        time.sleep(1800)

# Запускаем бота
if __name__ == "__main__":
    channel_name = "your_channel_name"  # Укажите ваш канал на Twitch
    run_bot(channel_name)

